let e,t=new Set,n=new Map,r=[],i,a=Symbol(),o=Symbol(),s=Symbol(),c=Symbol(),l=Symbol(),u=Symbol(),d=Symbol(),f=Symbol(),p=Symbol(),m=Symbol();function h(t,u){let d={[a]:`_`+Math.random(),[p]:t,[m]:u};return n.set(d[a],d),d.run=()=>{let t;e&&(t=e,d[o]=e[a],e[s]=e[s]||[],e[s].push(d[a])),d[c]?.forEach(e=>{e.delete(d[a])}),e=d;let n=d[p]();d[m]&&(e=null,d[m](n)),e=t},d.unwatch=function(){d[l]=1,r.push(d[a]),i&&clearTimeout(i),i=setTimeout(()=>{for(let e of r)g(e);r=[],i=null},50)},d.run(),d}function g(e){let t=n.get(e);if(t?.[u]?.(),t?.[s]){for(let e of t[s])g(e);t[o]=null,t[s]=null}if(t?.[c]){for(let n of t[c])n.delete(e);t[c]=null}n.delete(e)}function _(e){return v(e,new Map)}function v(t,n){let r=typeof t==`object`&&!Array.isArray(t)?Object.getOwnPropertyDescriptors(t):{};return new Proxy(t,{get(t,i,s){if(typeof i==`symbol`)return t[i];if(i==`__raw`)return t;if(r[i]?.get&&!t[o]){if(!e)return r[i].get.call(t);let n=i;if(i=`@@`+i,!r[n]._watcher){let a=e;e=null;let o=h(r[n].get.bind(t),e=>{t.hasOwnProperty(i)?s[i]=e:Object.defineProperty(t,i,{writable:!0,enumerable:!1,value:e})});o[u]=()=>{r[n]._watcher=null},r[n]._watcher=o,e=a}}let l;if(!t[d]&&t[o]){let e=[],n=t;for(;n?.[o];)n[f]&&(l=!0),e.push(n[o][1]),n=n[o][0];if(l){for(let t=e.length-1;t>=0;t--){n[d]=!0;let r=n?.[e[t]];n[d]=!1,n=t==0?r?.__raw:r,n??={}}t=n}}let p=t?.[i];if(typeof p==`function`)return p;if(typeof p==`object`&&p&&!p[o]&&(p.constructor?.name==`Object`||p.constructor?.name==`Array`||p.constructor?.name==null)&&(p[o]=[s,i],p=v(p,n),t[i]=p),e){let r=y(t,i),o=e[a],s=[r];e[c]=e[c]||new Set;for(let t of s){let r=n.get(t);r||(r=new Set,n.set(t,r)),r.add(o),e[c].add(r)}}return p},set(e,t,r){if(typeof t==`symbol`)return e[t]=r,!0;let i=e[t];return i?.[o]&&(i[f]=!0),r?.[o]&&Array.isArray(e)&&!isNaN(t)&&(r[o][1]=t),e[t]=r,(r!=i||t===`length`)&&b(e,t,n),!0},deleteProperty(e,t){if(typeof t!=`symbol`){b(e,t,n);let r=y(e,t);for(let e of n)(e[0]==r||e[0].startsWith(r+`/`))&&n.delete(e[0])}return delete e[t]}})}function y(e,t){let n=t,r=e?.[o];for(;r;)n=r[1]+`/`+n,r=r[0][o];return n}function b(e,r,i){let a=y(e,r),s=i.get(a);if(s)for(let e of s)t.delete(e),t.add(e),t.size==1&&queueMicrotask(()=>{let e={},r;for(let i of t)if(r=n.get(i),!(!r||r[l])&&!(r[o]&&t.has(r[o]))){if(e[i]=(e[i]||0)+1,e[i]>500){console.warn(`Possible infinite loop for watcher `+i+`:`,`
watch(`+r[p]?.toString()+(r[m]?`, `+r[m].toString():``)+`)`);continue}r.run()}t.clear()})}const x=new Proxy({},{get(e,t){return function(){return C(),O.call(void 0,t,...arguments)}}});let S=!1;function C(){if(S)return;S=!0;function e(t,n){for(let r of n)r[t]&&r[t](r),r.childNodes&&e(t,r.childNodes)}new MutationObserver(t=>{for(let n of t)e(`onmount`,n.addedNodes),e(`onunmount`,n.removedNodes)}).observe(document,{childList:!0,subtree:!0})}let w=Symbol(),T=Symbol(),E=Symbol(),D=Symbol();function O(e,t={},...n){let r=document.createElement(e);if(t)for(let e in t){let n=t[e],i=!1;e.length>5&&e.startsWith(`html-`)&&(i=!0,e=e.substring(5)),n===void 0?r.removeAttribute(e):typeof n!=`function`||e.length>2&&e.startsWith(`on`)?i?r.setAttribute(e,n):r[e]=n:(r[w]=r[w]||[],r[w].push(()=>{if(!r)return;let t=n(r,e);t===void 0?(r[e]!==void 0&&(r[e]=void 0),r.removeAttribute(e)):i?r.setAttribute(e,t):r[e]=t}))}let i=r.onmount;r.onmount=()=>{if(!r[E]){if(r[E]=!0,r[w]){r[T]=r[T]||[];for(let e of r[w])r[T].push(h(e))}i?.(r)}};let a=r.onunmount;return r.onunmount=()=>{if(r[E]){if(r[E]=!1,r[T])for(let e of r[T])e.unwatch();if(r[T]=null,r[D])for(let e of r[D])e();r[D]=null,a?.(r)}},k(r,n),r}function k(e,t){t=N(t);for(let n of t)if(typeof n==`function`)A(e,n);else{let t=P(n);Array.isArray(t)?k(e,t):t&&e.appendChild(t)}}function A(e,t){let n=document.createComment(``);e.appendChild(n);let r=[],i=new Map,a=e.moveBefore||e.insertBefore;e[D]=e[D]||[],e[D].push(()=>{r=null,i=null,n=null}),e[w]=e[w]||[],e[w].push(()=>{if(!e)return;let o=N(t(e)),s=o.length,c=new Map;if(!r?.length){let t=document.createDocumentFragment();for(let e=0;e<s;e++){o[e]=P(o[e]),t.appendChild(o[e]);let n=o[e].rid;n!==void 0&&(c.has(n)?console.warn(`Duplicated rid:`,n,o[e]):c.set(n,e))}e.insertBefore(t,n),t=null,r=o,i=c;return}let l=[],u=[],d=new Set,f=[];for(let e=0;e<s;e++){o[e]=P(o[e]);let t=o[e].rid;if(t!==void 0){c.has(t)?console.warn(`Duplicated rid:`,t,o[e]):c.set(t,e);let n=i.get(t);if(n>=0){d.add(r[n]),o[e]=r[n],f.push(n);continue}}u.push({child:o[e],prev:o[e-1]})}let p=j(f);f.length!=p.length&&f.forEach((e,t)=>{p.has(e)||l.push({child:r[e],currentPos:e,targetPos:t})});for(let t of l){let n=r[t.targetPos];M(r,t.currentPos,t.targetPos),a.call(e,t.child,n)}for(let e of u)e.prev?e.prev.after(e.child):(r[0]||n).before(e.child);for(let e=0;e<r.length;e++)d.has(r[e])||r[e].remove?.();r=o,i=c,o=null,c=null,d=null,l=null,u=null})}function j(e){let t=[],n=[];for(let r=0;r<e.length;r++){let i=e[r],a=0,o=0,s=t.length;for(;a<s;)o=Math.floor((a+s)/2),e[t[o]]>=i?s=o:a=o+1;a>0&&(n[r]=t[a-1]),t[a]=r}let r=new Set,i=t[t.length-1];for(;i!==void 0;)r.add(e[i]),i=n[i];return r}function M(e,t,n){if(t==n)return e;let r=t>n?-1:1,i=e[t];for(let i=t;i!=n;i+=r)e[i]=e[i+r];e[n]=i}function N(e){return e==null?[]:Array.isArray(e)?e:[e]}function P(e){if(typeof e==`string`||typeof e==`number`||typeof e==`boolean`){let t=document.createTextNode(e);return t.rid=e,t}return e?.__raw===void 0?e:e.__raw}function F(e,t={fallbackPath:`#/`,transition:!0}){let n=L(e),r,i=()=>{let e=window.location.hash,i=I(n,e);if(!i){if(t.fallbackPath!=e){window.location.hash=t.fallbackPath;return}console.warn(`missing route:`,e);return}let a=async()=>{try{await r?.(),r=await i.handler(i)}catch(e){console.warn(`route navigation failed:`,e)}};t.transition&&document.startViewTransition?document.startViewTransition(a):a()};return window.addEventListener(`hashchange`,i),i(),()=>{window.removeEventListener(`hashchange`,i)}}function I(e,t){for(let n of e){let e=t.match(n.regex);if(!e)continue;let r={},i=t.split(`?`)?.[1];if(i){let e=new URLSearchParams(i);for(let[t,n]of e.entries())Array.isArray(r[t])||(r[t]=r[t]?[r[t]]:[]),r[t].push(n)}return Object.assign({path:t,query:r,params:e.groups||{}},n)}}function L(e){let t=[];for(let n in e){let r=n.split(`/`);for(let e in r)r[e].length>2&&r[e].startsWith(`{`)&&r[e].endsWith(`}`)?r[e]=`(?<`+r[e].substring(1,r[e].length-1)+`>[^\\/#?]+)`:r[e]=RegExp.escape(r[e]);t.push({regex:RegExp(`^`+r.join(`\\/`)+`(?:[?#].*)?$`),pattern:n,handler:e[n]})}return t}export{F as router,_ as store,x as t,h as watch};
//# sourceMappingURL=shablon.es.js.map